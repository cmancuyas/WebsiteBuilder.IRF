@page "/admin/pages/edit/{id:int}"
@model WebsiteBuilder.IRF.Pages.Admin.Pages.EditModel
@using WebsiteBuilder.Models.Constants

<h2 class="mb-3">Edit Page</h2>

@if (Request.Query.ContainsKey("created"))
{
    <div class="alert alert-success">Page created successfully.</div>
}
@if (Request.Query.ContainsKey("saved"))
{
    <div class="alert alert-success">Changes saved.</div>
}

<form method="post" class="card">
    <div class="card-body">
        <input type="hidden" asp-for="Input.Id" />

        <!-- IMPORTANT: 'for="Input"' prefixes all fields as Input.* -->
        <partial name="_Form" for="Input" />
    </div>

    <div class="card-footer d-flex gap-2 justify-content-end">
        <a class="btn btn-outline-secondary" asp-page="./Index">Back</a>

        <button type="submit" class="btn btn-primary">Save</button>

        @* Draft preview (requires [slug] supports preview=true) *@
        @if (!string.IsNullOrWhiteSpace(Model.Input.Slug))
        {
            <a class="btn btn-outline-secondary"
               href="/@Model.Input.Slug?preview=true"
               target="_blank" rel="noopener">
                Preview
            </a>
        }
        else
        {
            <button type="button" class="btn btn-outline-secondary" disabled>
                Preview
            </button>
        }

        @{
            var isPublished = Model.Input.PageStatusId == PageStatusIds.Published;
        }

        @if (isPublished && !string.IsNullOrWhiteSpace(Model.Input.Slug))
        {
            <a class="btn btn-outline-secondary"
               href="/@Model.Input.Slug"
               target="_blank" rel="noopener">
                Open (Published)
            </a>
        }
        else
        {
            <button type="button" class="btn btn-outline-secondary" disabled
                    title="Set Status to Published then Save to open the public page.">
                Open (Published)
            </button>
        }

        <a class="btn btn-outline-secondary"
           asp-page="./Sections"
           asp-route-id="@Model.Input.Id">
            Sections
        </a>
    </div>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}

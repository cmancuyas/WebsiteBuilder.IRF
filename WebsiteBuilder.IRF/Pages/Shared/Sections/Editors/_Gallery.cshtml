@model string?
@using System.Text.Json

@{
    var images = new List<(string Url, string? Alt, string? Caption)>();

    if (!string.IsNullOrWhiteSpace(Model))
    {
        try
        {
            using var doc = JsonDocument.Parse(Model);

            if (doc.RootElement.TryGetProperty("images", out var arr) &&
                arr.ValueKind == JsonValueKind.Array)
            {
                foreach (var item in arr.EnumerateArray())
                {
                    if (item.ValueKind != JsonValueKind.Object)
                        continue;

                    var url = item.TryGetProperty("url", out var u) ? u.GetString() : null;
                    if (string.IsNullOrWhiteSpace(url))
                        continue;

                    var alt = item.TryGetProperty("alt", out var a) ? a.GetString() : null;
                    var caption = item.TryGetProperty("caption", out var c) ? c.GetString() : null;

                    images.Add((url!, alt, caption));
                }
            }
        }
        catch
        {
            <div class="alert alert-danger">
                Invalid Gallery JSON content.
            </div>
            return;
        }
    }
}

<section class="py-4">
    <div class="container">
        @if (images.Count == 0)
        {
            <div class="text-muted">No images.</div>
        }
        else
        {
            <div class="row g-3">
                @foreach (var img in images)
                {
                    <div class="col-6 col-md-4 col-lg-3">
                        <figure class="mb-0">
                            <img src="@img.Url" class="img-fluid rounded" alt="@img.Alt" />
                            @if (!string.IsNullOrWhiteSpace(img.Caption))
                            {
                                <figcaption class="small text-muted mt-1">@img.Caption</figcaption>
                            }
                        </figure>
                    </div>
                }
            </div>
        }
    </div>
</section>

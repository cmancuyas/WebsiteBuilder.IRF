@model WebsiteBuilder.Models.PageSection
@using System.Text.Json

@{
    // Reads from SettingsJson
    // { "items": [ { "mediaAssetId": 123, "caption": "", "alt": "", "url": "", "thumbUrl": "", "fileName": "" } ] }

    var items = new List<(string Url, string Alt, string Caption)>();

    if (!string.IsNullOrWhiteSpace(Model.SettingsJson))
    {
        try
        {
            using var doc = JsonDocument.Parse(Model.SettingsJson);
            if (doc.RootElement.TryGetProperty("items", out var arr) && arr.ValueKind == JsonValueKind.Array)
            {
                foreach (var it in arr.EnumerateArray())
                {
                    var url = it.TryGetProperty("url", out var u) ? (u.GetString() ?? "") : "";
                    var alt = it.TryGetProperty("alt", out var a) ? (a.GetString() ?? "") : "";
                    var caption = it.TryGetProperty("caption", out var c) ? (c.GetString() ?? "") : "";

                    if (!string.IsNullOrWhiteSpace(url))
                        items.Add((url, alt, caption));
                }
            }
        }
        catch { /* ignore */ }
    }
}

@if (items.Count == 0)
{
    <!-- No gallery items -->
}
else
{
    <section class="py-4">
        <div class="container">
            <div class="row g-3">
                @foreach (var it in items)
                {
                    <div class="col-12 col-sm-6 col-md-4">
                        <figure class="m-0">
                            <img src="@it.Url" alt="@it.Alt" class="img-fluid rounded shadow-sm" />
                            @if (!string.IsNullOrWhiteSpace(it.Caption))
                            {
                                <figcaption class="small text-muted mt-2">@it.Caption</figcaption>
                            }
                        </figure>
                    </div>
                }
            </div>
        </div>
    </section>
}

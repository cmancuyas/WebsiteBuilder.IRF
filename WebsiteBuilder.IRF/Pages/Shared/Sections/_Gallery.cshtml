@model WebsiteBuilder.Models.PageSection
@using System.Text.Json

@{
    List<(string Url, string? Alt)> images = new();

    if (!string.IsNullOrWhiteSpace(Model.ContentJson))
    {
        try
        {
            using var doc = JsonDocument.Parse(Model.ContentJson);

            if (doc.RootElement.TryGetProperty("images", out var imgs) &&
                imgs.ValueKind == JsonValueKind.Array)
            {
                foreach (var item in imgs.EnumerateArray())
                {
                    if (item.ValueKind != JsonValueKind.Object) continue;

                    var url = item.TryGetProperty("url", out var u) ? u.GetString() : null;
                    var alt = item.TryGetProperty("alt", out var a) ? a.GetString() : null;

                    if (!string.IsNullOrWhiteSpace(url))
                        images.Add((url!, alt));
                }
            }
        }
        catch
        {
            <div class="alert alert-danger mb-0">
                Invalid Gallery JSON content.
            </div>
            return;
        }
    }
}

<section class="py-4">
    <div class="container">
        @if (images.Count == 0)
        {
            <div class="text-muted">No gallery images.</div>
        }
        else
        {
            <div class="row g-3">
                @foreach (var img in images)
                {
                    <div class="col-6 col-md-4 col-lg-3">
                        <div class="border rounded overflow-hidden">
                            <img src="@img.Url"
                                 alt="@(img.Alt ?? string.Empty)"
                                 class="img-fluid d-block" />
                        </div>
                    </div>
                }
            </div>
        }
    </div>
</section>
